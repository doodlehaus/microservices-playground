# Progress Summary - November 27, 2025

## Overview
Today we set up core infrastructure services and deployed our first microservice to the Kubernetes cluster.

## Infrastructure Setup

### 1. RabbitMQ Management UI (Completed)
- **Status:** Running and accessible
- **Location:** pigpen node
- **Access:** http://192.168.68.61:30672
- **Credentials:** admin / admin
- **Purpose:** Message broker for microservices communication
- **Configuration:**
  - NodePort service for external access
  - Management plugin enabled
  - Persistent storage: 5Gi at /data/rabbitmq

### 2. ElasticSearch (Completed)
- **Status:** Running and healthy
- **Version:** 8.17.0
- **Location:** pigpen node
- **Access:** http://192.168.68.61:30920
- **Cluster Name:** microservices-cluster
- **Configuration:**
  - Single-node cluster
  - 20Gi persistent storage at /data/elasticsearch
  - Security disabled (xpack.security.enabled: false)
  - Memory: 512MB heap, 1-2GB total
  - Health Status: GREEN
- **Key Learnings:**
  - Required fsGroup and runAsUser security context for proper permissions
  - Init container needed to fix ownership of data directory
  - Probe timings adjusted for slower startup (120s liveness, 90s readiness)

### 3. Kibana (Completed)
- **Status:** Running and available
- **Version:** 8.17.0
- **Location:** pigpen node
- **Access:** http://192.168.68.61:30561
- **Configuration:**
  - Connected to ElasticSearch at http://elasticsearch:9200
  - 5Gi persistent storage at /data/kibana
  - Dev Tools console available for testing
  - Memory: 512MB-1GB

### 4. Docker Registry (Completed)
- **Status:** Running
- **Purpose:** Internal container image storage (not currently used)
- **Access:** NodePort 30500
- **Note:** Using Docker Hub (doodlehaus) for image storage instead

## Microservices

### Hello World Service (Completed ✅)

#### Overview
- **Language:** Node.js 20
- **Framework:** Express.js
- **Status:** Running with 2 replicas
- **Docker Image:** doodlehaus/hello-world:latest
- **Access:** http://192.168.68.61:30300

#### Endpoints
- `GET /` - Hello World message with timestamp and hostname
- `GET /health` - Health check endpoint (used by Kubernetes probes)

#### Response Examples
```json
// GET /
{
  "message": "Hello World!",
  "service": "hello-world",
  "timestamp": "2025-11-27T14:40:52.076Z",
  "hostname": "hello-world-5d4688b46c-bl5pv"
}

// GET /health
{
  "status": "healthy",
  "uptime": 93.30005708
}
```

#### Technical Details
- **Namespace:** services
- **Replicas:** 2
- **Resources:**
  - Requests: 64Mi memory, 50m CPU
  - Limits: 128Mi memory, 100m CPU
- **Health Checks:**
  - Liveness probe: /health endpoint, 10s initial delay
  - Readiness probe: /health endpoint, 5s initial delay
- **Services:**
  - ClusterIP (internal): hello-world:3000
  - NodePort (external): 30300

#### Build Process
- Multi-platform Docker image (linux/amd64, linux/arm64)
- Published to Docker Hub
- Key fixes applied:
  - Changed from `npm ci` to `npm install` (no package-lock.json)
  - Added `chown -R node:node /app` for proper file permissions
  - Built for ARM64 to support Raspberry Pi nodes

#### File Structure
```
services/hello-world/
├── src/
│   └── index.js          # Express application
├── k8s/
│   ├── namespace.yaml    # Services namespace
│   ├── deployment.yaml   # Kubernetes deployment
│   └── service.yaml      # Internal + external services
├── Dockerfile            # Multi-platform Docker build
├── .dockerignore
└── package.json
```

## Cluster Information

### Nodes
- **bobby** (192.168.68.133) - Control plane, Debian 12, ARM64
- **jerry** (192.168.68.134) - Worker, Debian 12, ARM64
- **pigpen** (192.168.68.61) - Worker, Ubuntu 24.04, ARM64

### Namespaces
- `infrastructure` - RabbitMQ, ElasticSearch, Kibana, Registry
- `services` - Microservices (hello-world)

### Storage
All infrastructure components use local-storage PersistentVolumes on pigpen:
- `/data/rabbitmq` - 5Gi
- `/data/elasticsearch` - 20Gi
- `/data/kibana` - 5Gi

## Network Access Summary

All services accessible from local network (192.168.68.x):

| Service | Port | URL |
|---------|------|-----|
| RabbitMQ Management | 30672 | http://192.168.68.61:30672 |
| ElasticSearch API | 30920 | http://192.168.68.61:30920 |
| Kibana UI | 30561 | http://192.168.68.61:30561 |
| Hello World Service | 30300 | http://192.168.68.61:30300 |

## Key Learnings

1. **ARM Architecture:** Required multi-platform Docker builds for Raspberry Pi compatibility
2. **File Permissions:** Container user permissions critical for proper operation
3. **Probe Timing:** ElasticSearch requires longer startup times, adjusted probes accordingly
4. **NodePort Services:** Provide easy local network access without ingress controller
5. **Docker Hub:** Simpler than managing local registry for development

## Next Steps

Potential areas to explore:
- Add more microservices (API gateway, user service, etc.)
- Implement service-to-service communication
- Connect services to RabbitMQ for messaging
- Store application data in ElasticSearch
- Set up logging pipeline to ElasticSearch/Kibana
- Add monitoring and observability
- Implement API authentication
- Create ingress controller for unified access
